<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Diagnosis Result</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: auto; }
        .header { border-bottom: 1px solid #ccc; padding-bottom: 10px; }
        .issue { border: 1px solid #ddd; margin-top: 10px; padding: 10px; border-radius: 5px; }
        .severity-Critical { color: red; font-weight: bold; }
        .severity-High { color: orange; font-weight: bold; }
        .severity-Medium { color: #ccce0b; }
        .severity-Low { color: green; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Diagnosis Result</h1>
            <div id="summary">Loading...</div>
        </div>
        <div id="issues-list"></div>
    </div>

    <script>
        // Function to render result from JSON
        function renderResult(data) {
            document.getElementById('summary').innerHTML = `
                <p><strong>ID:</strong> ${data.id}</p>
                <p><strong>Status:</strong> ${data.status}</p>
                <p><strong>Summary:</strong> ${data.summary}</p>
            `;

            const list = document.getElementById('issues-list');
            list.innerHTML = '<h3>Issues Found</h3>';

            if (!data.issues || data.issues.length === 0) {
                list.innerHTML += '<p>No issues found.</p>';
                return;
            }

            data.issues.forEach(issue => {
                const div = document.createElement('div');
                div.className = 'issue';
                div.innerHTML = `
                    <h4><span class="severity-${issue.severity}">[${issue.severity}]</span> ${issue.title}</h4>
                    <p>${issue.description}</p>
                    ${issue.evidence ? `<pre>${issue.evidence}</pre>` : ''}
                    ${renderRecommendations(issue.recommendations)}
                `;
                list.appendChild(div);
            });
        }

        function renderRecommendations(recs) {
            if (!recs || recs.length === 0) return '';
            let html = '<h5>Recommendations:</h5><ul>';
            recs.forEach(r => {
                html += `<li>${r.description} ${r.command ? `<code>${r.command}</code>` : ''}</li>`;
            });
            html += '</ul>';
            return html;
        }

        // Example: Fetch data from API if ID is in query param
        const urlParams = new URLSearchParams(window.location.search);
        const diagId = urlParams.get('id');
        if (diagId) {
            fetch('/api/v1/diagnosis/' + diagId) // Using the API endpoint we defined/will define
                .then(response => response.json())
                .then(data => renderResult(data))
                .catch(err => {
                    document.getElementById('summary').innerText = 'Error loading result: ' + err;
                });
        } else {
            document.getElementById('summary').innerText = 'No Diagnosis ID provided in URL (?id=...)';
        }
    </script>
</body>
</html>
